<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>IB PYP Smart Planner</title>

<style>
body {
    margin: 0;
    font-family: "Segoe UI", sans-serif;
    background: #f4f6f8;
}

header {
    background: #2c3e50;
    color: white;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

button {
    padding: 8px 12px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}

.primary { background: #1abc9c; color: white; }
.danger { background: #e74c3c; color: white; }
.secondary { background: #34495e; color: white; }

.container {
    display: flex;
    height: calc(100vh - 60px);
}

.sidebar {
    width: 260px;
    background: #ffffff;
    padding: 15px;
    border-right: 1px solid #ddd;
    overflow-y: auto;
}

.main {
    flex: 1;
    padding: 25px;
    overflow-y: auto;
}

.unit {
    padding: 8px;
    margin: 5px 0;
    border-radius: 6px;
    cursor: pointer;
    background: #ecf0f1;
}

.unit:hover {
    background: #dfe6e9;
}

.active {
    background: #1abc9c;
    color: white;
}

.section {
    background: white;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
}

input, textarea, select {
    width: 100%;
    padding: 8px;
    margin-top: 6px;
    border-radius: 6px;
    border: 1px solid #ccc;
}

textarea {
    min-height: 80px;
}

h3 {
    border-bottom: 1px solid #ddd;
    padding-bottom: 5px;
}
</style>
</head>

<body>

<header>
    <h2>üìò IB PYP Smart Planner</h2>
    <button class="primary" onclick="createUnit()">+ New Unit</button>
</header>

<div class="container">

<!-- Sidebar -->
<div class="sidebar">
    <h3>Your Units</h3>
    <div id="unitList"></div>
    <br>
    <button class="secondary" onclick="renameUnit()">‚úèÔ∏è Rename</button>
    <button class="danger" onclick="deleteUnit()">üóë Delete</button>
</div>

<!-- Main -->
<div class="main">

<div class="section">
<h3>Unit Overview</h3>

<label>Unit Title</label>
<input id="unitTitle">

<label>Transdisciplinary Theme</label>
<select id="theme">
    <option value="">Select</option>
    <option>Who we are</option>
    <option>Where we are in place and time</option>
    <option>How we express ourselves</option>
    <option>How the world works</option>
    <option>How we organize ourselves</option>
    <option>Sharing the planet</option>
</select>

<label>Key Concepts</label>
<select id="keyConcepts" multiple>
    <option>Form</option>
    <option>Function</option>
    <option>Causation</option>
    <option>Change</option>
    <option>Connection</option>
    <option>Perspective</option>
    <option>Responsibility</option>
    <option>Reflection</option>
</select>

<label>Central Idea</label>
<textarea id="central"></textarea>
</div>

<div class="section">
<h3>AI Suggestions (Auto)</h3>

<label>Lines of Inquiry</label>
<textarea id="aiInquiry"></textarea>

<label>Learning Experiences</label>
<textarea id="aiLearning"></textarea>
</div>

<div class="section">
<h3>Reflection</h3>
<textarea id="reflection"></textarea>
</div>

</div>
</div>

<script>
let units = JSON.parse(localStorage.getItem("PYP_UNITS")) || [];
let currentIndex = null;

function renderUnits() {
    const list = document.getElementById("unitList");
    list.innerHTML = "";
    units.forEach((u, i) => {
        const div = document.createElement("div");
        div.className = "unit" + (i === currentIndex ? " active" : "");
        div.textContent = u.name;
        div.onclick = () => loadUnit(i);
        list.appendChild(div);
    });
}

function createUnit() {
    const name = prompt("Enter unit name:");
    if (!name) return;

    units.push({ name, data: {} });
    currentIndex = units.length - 1;
    saveAll();
    renderUnits();
    loadUnit(currentIndex);
}

function loadUnit(i) {
    currentIndex = i;
    const d = units[i].data || {};

    unitTitle.value = d.unitTitle || "";
    theme.value = d.theme || "";
    central.value = d.central || "";
    aiInquiry.value = d.aiInquiry || "";
    aiLearning.value = d.aiLearning || "";
    reflection.value = d.reflection || "";

    [...keyConcepts.options].forEach(opt => {
        opt.selected = d.keyConcepts?.includes(opt.value);
    });

    renderUnits();
}

function autoSave() {
    if (currentIndex === null) return;

    units[currentIndex].data = {
        unitTitle: unitTitle.value,
        theme: theme.value,
        keyConcepts: [...keyConcepts.selectedOptions].map(o => o.value),
        central: central.value,
        aiInquiry: aiInquiry.value,
        aiLearning: aiLearning.value,
        reflection: reflection.value
    };

    saveAll();
}

function saveAll() {
    localStorage.setItem("PYP_UNITS", JSON.stringify(units));
}

function renameUnit() {
    if (currentIndex === null) return;
    const name = prompt("Rename unit:");
    if (!name) return;
    units[currentIndex].name = name;
    saveAll();
    renderUnits();
}

function deleteUnit() {
    if (currentIndex === null) return;
    if (!confirm("Delete this unit?")) return;

    units.splice(currentIndex, 1);
    currentIndex = null;
    saveAll();
    renderUnits();
    location.reload();
}

document.querySelectorAll("input, textarea, select").forEach(el => {
    el.addEventListener("input", autoSave);
});

renderUnits();
</script>

</body>
</html>
